<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Corrections â€” Logigrammes â€” SÃ©rie nÂ°2 </title>
  <style>
  /* Base */
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
    background:#f9fafb;
    color:#1a1a1a;
    display:flex; min-height:100dvh; align-items:center; justify-content:center;
  }

  /* L'app devient une colonne flexible */
  .app{
    width:min(1100px,92vw);
    display:flex;
    flex-direction:column;
    /* Ã©vite que la signature masque le bas */
  }

  /* Barre dâ€™outils */
  .toolbar{
    display:flex; flex-wrap:wrap; gap:.5rem; align-items:center;
    background:#fff; border:1px solid #ccc; border-radius:12px; padding:.6rem .8rem;
    box-shadow:0 4px 12px rgba(0,0,0,.08);
  }
  .title{ font-weight:800; margin-right:auto; letter-spacing:.3px; }
  select, .btn{
    appearance:none; border:1px solid #ccc; background:#f1f5f9; color:#222;
    padding:.4rem .8rem; border-radius:8px; cursor:pointer; font-weight:600; transition:all .15s ease;
  }
  .btn:hover, select:hover{ background:#e5e9ef; }
  .range{ accent-color:#3b82f6; }

  /* Viewer + layout prennent toute la hauteur dispo */
  .viewer{
    position:relative; margin-top:12px; background:#fff; border:1px solid #ccc; border-radius:12px;
    padding:12px; box-shadow:0 8px 20px rgba(0,0,0,.08);
    flex:1;                 /* NEW */
    display:flex;           /* NEW */
    flex-direction:column;  /* NEW */
    /* Gestes tactiles : on gÃ¨re nous-mÃªmes le scroll/gestes dans le viewer */
.viewer { touch-action: none; }

  }
  .layout{
    flex:1; /* NEW */
    display:grid;
    grid-template-columns:1.3fr .9fr;
    gap:12px;
  }
  @media (max-width:900px){ .layout{ grid-template-columns:1fr; } }

  /* Colonne gauche = colonne flexible : la scÃ¨ne peut grandir */
  .layout > div:first-child{
    display:flex;           /* NEW */
    flex-direction:column;  /* NEW */
    min-height:0;           /* NEW: Ã©vite les dÃ©bordements */
  }

  /* ScÃ¨ne */
  .stage{
    position:relative; width:100%;
    aspect-ratio:16/9; background:#f3f4f6; border-radius:8px; overflow:hidden;
    display:grid; place-items:center;
    flex:1; /* NEW : occupe la hauteur */
  }
  .layer{
    position:absolute; inset:0; object-fit:contain; width:100%; height:100%;
    opacity:0; transition:opacity 320ms ease; pointer-events:none;
  }
  .layer.visible{ opacity:1; }

  /* LÃ©gende + pastilles */
  .legend{ display:flex; justify-content:space-between; align-items:center; gap:.8rem; margin-top:.6rem; font-size:.92rem; color:#444; }
  .dots{ display:flex; gap:.35rem; align-items:center; flex-wrap:wrap; }
  .dot{ width:.7rem; height:.7rem; border-radius:999px; background:#d1d5db; border:1px solid #9ca3af; }
  .dot.active{ background:#3b82f6; border-color:#2563eb; }

  /* Bloc explications */
  .explanation{
    background:#f0f9ff; border-left:4px solid #3b82f6; border-radius:6px; padding:12px; line-height:1.5;
  }
  .muted{ color:#555; }

  /* Signature en bas Ã  droite DU GRAND BLOC BLANC (.viewer) */
  .signature{
    text-align:right;
    font-size:.8rem;
    color:#1e3a8a;
    font-weight:600;
    margin-top:12px;
    padding-top:6px;
    border-top:1px solid #e5e7eb;
  }

  /* === PLEIN Ã‰CRAN === */
  /* Quand .app passe en fullscreen, elle occupe TOUT l'Ã©cran */
  .app:fullscreen,
  .app:-webkit-full-screen{
    width:100vw;
    height:100dvh;
    max-width:none;
  }
  /* Forcer les descendants Ã  prendre la hauteur */
  .app:fullscreen .viewer,
  .app:-webkit-full-screen .viewer{
    flex:1;
  }
  .app:fullscreen .layout,
  .app:-webkit-full-screen .layout{
    height:100%;
  }
</style>

</head>

<body>
  <div class="app">
    <div class="toolbar">
      <div class="title">Corrections â€” Logigrammes â€” SÃ©rie nÂ°2</div>
      <label for="exercise" class="muted">Exercice</label>
      <select id="exercise"></select>
      <button id="play"  class="btn" aria-pressed="false" title="Lecture/Pause (Espace)">Lecture</button>
      <button id="prev"  class="btn" title="PrÃ©cÃ©dent (â†)">âŸµ</button>
      <button id="next"  class="btn" title="Suivant (â†’)">âŸ¶</button>
      <button id="reset" class="btn" title="RÃ©initialiser (R)">RÃ©init</button>
      <button id="fullscreen" class="btn" title="Plein Ã©cran (F)" aria-pressed="false">â›¶ Plein Ã©cran</button>

      <label for="speed" class="muted">Vitesse</label>
      <input id="speed" class="range" type="range" min="400" max="4000" step="100" value="1200" />
    </div>

    <div class="viewer">
  <div class="layout">
    <!-- Colonne gauche : images -->
    <div>
      <div class="stage" id="stage"></div>
      <div class="legend">
        <div id="status"></div>
        <div class="dots" id="dots"></div>
      </div>
    </div>

    <!-- Colonne droite : explications -->
    <div>
      <div class="explanation">
        <div id="exTitle" style="font-weight:700;margin-bottom:.3rem;"></div>
        <div id="stepTitle" style="font-weight:600;margin-bottom:.2rem;"></div>
        <div id="expl"></div>
        <div class="muted" style="margin-top:.6rem;font-size:.9rem;">
          Astuce : <b>Espace</b> lecture/pause â€¢ <b>â†</b>/<b>â†’</b> Ã©tape prÃ©cÃ©dente/suivante â€¢ <b>R</b> rÃ©init.
        </div>
      </div>
    </div>
  </div>

  <!-- ğŸ‘‰ Signature en bas Ã  droite du grand bloc blanc -->
  <div class="signature">
    Technologie â€“ Les algorithmes -  Vincent Belhaire<br>
  </div>
</div>

      </div>
    </div>
  </div>

  <script>
  const MANIFEST = [
    {
      "title": "1 - Porte de garage",
      "steps": [
        { "src": "1-Porte de garage/Aucun bouton.svg", "label": "ScÃ©nario 1",
          "explanation": "ğŸ‘‰ Lâ€™utilisateur nâ€™appuie sur aucun bouton. La tÃ©lÃ©commande attend, en boucle, quâ€™un bouton soit appuyÃ©." },

        { "src": "1-Porte de garage/Porte ouverte.svg", "label": "ScÃ©nario 2",
          "explanation": "ğŸ‘‰ Lâ€™utilisateur appuie sur le bouton 1, la tÃ©lÃ©commande envoie lâ€™ordre dâ€™ouvrir la porte du garage." },

        { "src": "1-Porte de garage/Porte 2.svg", "label": "ScÃ©nario 3",
          "explanation": "ğŸ‘‰Lâ€™utilisateur appuie sur le bouton 2, la tÃ©lÃ©commande envoie lâ€™ordre de fermer la porte du garage." }
      ]
    },
    {
      "title": "2 - Machine Ã  cafÃ©",
      "steps": [
        { "src": "2-Machine Ã  cafÃ©/Attente.svg", "label": "ScÃ©nario 1",
          "explanation": "ğŸ‘‰ La machine Ã  cafÃ© attend que lâ€™utilisateur appuie sur le bouton pour lâ€™activer." },

        { "src": "2-Machine Ã  cafÃ©/Ajouter de l'eau.svg", "label": "ScÃ©nario 2",
          "explanation": "ğŸ‘‰ Lâ€™utilisateur appuie sur le bouton. La machine vÃ©rifie la prÃ©sence dâ€™eau. Il manque de lâ€™eau et elle demande Ã  lâ€™utilisateur dâ€™en ajouter." },

        { "src": "2-Machine Ã  cafÃ©/Chauffer.svg", "label": "ScÃ©nario 3",
          "explanation": "ğŸ‘‰ Lâ€™utilisateur appuie sur le bouton. La machine vÃ©rifie la prÃ©sence dâ€™eau. Il y a de lâ€™eau. Elle vÃ©rifie si lâ€™eau a une tempÃ©rature supÃ©rieure Ã  88 Â°C. Ce nâ€™est pas le cas : la machine chauffe lâ€™eau." },

        { "src": "2-Machine Ã  cafÃ©/Servir.svg", "label": "ScÃ©nario 4",
          "explanation": "ğŸ‘‰ Lâ€™utilisateur appuie sur le bouton. La machine vÃ©rifie la prÃ©sence dâ€™eau. Il y a de lâ€™eau. Elle vÃ©rifie si lâ€™eau a une tempÃ©rature supÃ©rieure Ã  88 Â°C. Câ€™est le cas : la machine sert le cafÃ©.<br>ğŸ‘‰ Si la tempÃ©rature avait Ã©tÃ© infÃ©rieure Ã  88 Â°C, la machine aurait chauffÃ© lâ€™eau automatiquement jusquâ€™Ã  atteindre la bonne tempÃ©rature, puis elle aurait servi le cafÃ©." }
      ]
    },
    {
      "title": "3 - RÃ©ception dâ€™un hÃ´tel",
      "steps": [
	{ "src": "3-RÃ©ception d'un hÃ´tel/Jour en attente.svg", "label": "ScÃ©nario 1",
          "explanation": "ğŸ‘‰ Le systÃ¨me vÃ©rifie sâ€™il fait jour ou nuit. Câ€™est le jour (8h00 â€“ 22h00) : le concierge est prÃ©sent.<br>Le systÃ¨me attend, en boucle, que le concierge appuie sur le bouton.<br>Il se rÃ©interroge ,en boucle, afin de savoir sâ€™il fait jour ou nuit." },

        { "src": "3-RÃ©ception d'un hÃ´tel/Ouverture concierge.svg", "label": "ScÃ©nario 2",
          "explanation": "ğŸ‘‰ Le systÃ¨me vÃ©rifie sâ€™il fait jour ou nuit. Câ€™est le jour (8h00 â€“ 22h00).<br>Il attend, en boucle, que le concierge appuie sur le bouton.<br>Lorsque le concierge appuie, le systÃ¨me dÃ©verrouille la porte, attend 5 secondes, puis la referme.<br>Ensuite, il se rÃ©interroge afin de savoir sâ€™il fait jour ou nuit." },

        { "src": "3-RÃ©ception d'un hÃ´tel/Nuit digicode faux.svg", "label": "ScÃ©nario 3",
          "explanation": "ğŸ‘‰Le systÃ¨me vÃ©rifie sâ€™il fait jour ou nuit. Cette fois-ci, câ€™est la nuit (22h00 â€“ 8h00).<br>Il nâ€™y a pas de veilleur de nuit : le client doit utiliser un digicode pour entrer. Le systÃ¨me attend, en boucle, que le code soit correct.<br>Le client entre un code faux : le systÃ¨me revient Ã  son Ã©tat initial et se rÃ©interroge afin de savoir sâ€™il fait jour ou nuit." },

	{ "src": "3-RÃ©ception d'un hÃ´tel/Digicode ok.svg", "label": "ScÃ©nario 4",
          "explanation": "ğŸ‘‰ Le systÃ¨me vÃ©rifie sâ€™il fait jour ou nuit. Cette fois-ci, câ€™est la nuit (22h00 â€“ 8h00).<br>Il nâ€™y a pas de veilleur de nuit : le client doit utiliser un digicode.<br>Le client entre un code correct : le systÃ¨me dÃ©verrouille la porte, attend 5 secondes, puis la referme. Ensuite, il se rÃ©interroge afin de savoir sâ€™il fait jour ou nuit." }
      ]
    },
        {
      "title": "4 - Parking",
      "steps": [
        { "src": "4-Parking/Attente voiture.svg", "label": "ScÃ©nario 1",
          "explanation": "ğŸ‘‰ Le systÃ¨me ne dÃ©tecte aucune voiture. Il attend, en boucle, lâ€™arrivÃ©e dâ€™un vÃ©hicule" },

        { "src": "4-Parking/e1.svg", "label": "ScÃ©nario 2",
          "explanation": "ğŸ‘‰ Le systÃ¨me dÃ©tecte une voiture Ã  lâ€™entrÃ©e. Il lit la plaque, lâ€™enregistre dans la variable plaque et note lâ€™heure dâ€™arrivÃ©e dans la variable h_entrÃ©e. Il ouvre la barriÃ¨re et attend, en boucle, que la voiture passe. La voiture nâ€™a pas encore franchi la barriÃ¨re." },

        { "src": "4-Parking/e2.svg", "label": "ScÃ©nario 3 ",
          "explanation": "ğŸ‘‰ Le systÃ¨me dÃ©tecte une voiture Ã  lâ€™entrÃ©e. Il lit la plaque, lâ€™enregistre dans la variable plaque et note lâ€™heure dâ€™arrivÃ©e dans la variable h_entrÃ©e. Il ouvre la barriÃ¨re et dÃ©tecte le passage de la voiture, puis referme la barriÃ¨re.Le systÃ¨me revient alors Ã  son Ã©tat initial et attend, en boucle, un nouveau vÃ©hicule." },

        { "src": "4-Parking/Attente paiement.svg", "label": "ScÃ©nario 4",
          "explanation": "ğŸ‘‰ Le systÃ¨me dÃ©tecte une voiture Ã  la sortie. Il lit la plaque, calcule le prix Ã  payer et lâ€™affiche. Il attend, en boucle, que le client paie. Le client nâ€™a pas encore payÃ©." },

{ "src": "4-Parking/Sattente passage.svg", "label": "ScÃ©nario 5",
          "explanation": "ğŸ‘‰ Le systÃ¨me dÃ©tecte une voiture Ã  la sortie. Il lit la plaque, calcule le prix Ã  payer et lâ€™affiche. Le client paie. Le systÃ¨me ouvre la barriÃ¨re et attend, en boucle, que la voiture passe. Le client nâ€™a pas encore franchi la barriÃ¨re." },

{ "src": "4-Parking/S ok.svg", "label": "ScÃ©nario 6",
          "explanation": "ğŸ‘‰Le systÃ¨me dÃ©tecte une voiture Ã  la sortie. Il lit la plaque, calcule le prix Ã  payer et lâ€™affiche. Le client paie. Le systÃ¨me ouvre la barriÃ¨re et attend, en boucle, que la voiture passe. Le client franchit la barriÃ¨re. Le systÃ¨me referme la barriÃ¨re, revient Ã  son Ã©tat initial et attend, en boucle, un nouveau vÃ©hicule. " }
      ]
    }
  ];

  const stage = document.getElementById('stage');
  const dotsEl = document.getElementById('dots');
  const statusEl = document.getElementById('status');
  const playBtn = document.getElementById('play');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');
  const resetBtn = document.getElementById('reset');
  const speedInput = document.getElementById('speed');
  const selectEl = document.getElementById('exercise');
  const fsBtn = document.getElementById('fullscreen');
const fsTarget = document.querySelector('.app'); // on met en plein Ã©cran TOUTE l'app pour garder la signature visible



  const exTitleEl = document.getElementById('exTitle');
  const stepTitleEl = document.getElementById('stepTitle');
  const explEl = document.getElementById('expl');

  let currentExercise = 0;
  let idx = 0;
  let playing = false;
  let timer = null;
  let stepDuration = parseInt(speedInput.value, 10);
  let layers = [];

  function initSelect(){
    selectEl.innerHTML = '';
    MANIFEST.forEach((ex, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = ex.title;
      selectEl.appendChild(opt);
    });
    selectEl.addEventListener('change', () => {
      stop();
      currentExercise = parseInt(selectEl.value, 10);
      loadExercise();
    });
  }

  function buildStage(ex){
    stage.innerHTML = '';
    layers = ex.steps.map(step => {
      const img = document.createElement('img');
      img.className = 'layer';
      img.alt = step.label;
      img.src = step.src;
      img.addEventListener('error', () => {
        statusEl.textContent = 'âš ï¸ Fichier introuvable : ' + (img.getAttribute('src') || '');
        img.style.outline = '2px dashed #e11d48';
      }, { once: true });
      stage.appendChild(img);
      return img;
    });
  }

  function buildDots(len){
    dotsEl.innerHTML = '';
    for(let i=0;i<len;i++){ const d=document.createElement('div'); d.className='dot'; dotsEl.appendChild(d); }
  }
  function updateDots(iActive){
    Array.from(dotsEl.children).forEach((d,i)=>d.classList.toggle('active', i===iActive));
  }
  function applyVisibility(){
    layers.forEach((el,i)=> el.classList.toggle('visible', i===idx));
  }
  function setIndex(newIdx){
    idx = Math.max(0, Math.min(layers.length-1, newIdx));
    applyVisibility();
    const ex = MANIFEST[currentExercise];
    const step = ex.steps[idx];
    statusEl.textContent = `Ã‰tape ${idx+1} / ${layers.length}`;
    exTitleEl.textContent = ex.title;
    stepTitleEl.textContent = step.label;
    explEl.innerHTML = step.explanation;
    updateDots(idx);
  }

  function next(){ if(idx < layers.length-1){ setIndex(idx+1); } else { setIndex(0); } }
  function prev(){ if(idx > 0){ setIndex(idx-1); } }
  function resetAll(){ stop(); setIndex(0); }

  function tick(){
    if(!playing) return;
    next();
    timer = setTimeout(tick, stepDuration);
  }
  function play(){
    if(playing) return;
    playing = true;
    playBtn.setAttribute('aria-pressed','true');
    playBtn.textContent = 'Pause';
    timer = setTimeout(tick, stepDuration);
  }
  function stop(){
    playing = false;
    playBtn.setAttribute('aria-pressed','false');
    playBtn.textContent = 'Lecture';
    if(timer){ clearTimeout(timer); timer=null; }
  }
  function togglePlay(){ playing ? stop() : play(); }

  speedInput.addEventListener('input', e => {
    stepDuration = parseInt(e.target.value, 10);
    if(playing){ stop(); play(); }
  });
  playBtn.addEventListener('click', togglePlay);
  prevBtn.addEventListener('click', ()=>{ stop(); prev(); });
  nextBtn.addEventListener('click', ()=>{ stop(); next(); });
  resetBtn.addEventListener('click', resetAll);

  window.addEventListener('keydown', (e) => {
    if(['INPUT','TEXTAREA','SELECT'].includes(document.activeElement?.tagName)) return;
    if(e.code === 'Space'){ e.preventDefault(); togglePlay(); }
    if(e.key === 'ArrowRight'){ e.preventDefault(); stop(); next(); }
    if(e.key === 'ArrowLeft'){ e.preventDefault(); stop(); prev(); }
    if(e.key.toLowerCase() === 'r'){ e.preventDefault(); resetAll(); }
  });

  function loadExercise(){
    const ex = MANIFEST[currentExercise];
    buildStage(ex);
    buildDots(ex.steps.length);
    setIndex(0);
  }

  initSelect();
  loadExercise();
  function isFullscreen() {
  return document.fullscreenElement != null;
}

async function enterFullscreen() {
  const el = fsTarget;
  if (el.requestFullscreen) await el.requestFullscreen();
  else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen(); // Safari
}

async function exitFullscreen() {
  if (document.exitFullscreen) await document.exitFullscreen();
  else if (document.webkitExitFullscreen) document.webkitExitFullscreen(); // Safari
}

async function toggleFullscreen() {
  if (isFullscreen()) await exitFullscreen();
  else await enterFullscreen();
}

document.addEventListener('fullscreenchange', () => {
  const state = isFullscreen();
  fsBtn.setAttribute('aria-pressed', state ? 'true' : 'false');
  fsBtn.textContent = state ? 'Quitter plein Ã©cran' : 'â›¶ Plein Ã©cran';
});

// clic bouton
fsBtn.addEventListener('click', toggleFullscreen);

// raccourci clavier F (Esc sort du plein Ã©cran automatiquement)
window.addEventListener('keydown', (e) => {
  if (['INPUT','TEXTAREA','SELECT'].includes(document.activeElement?.tagName)) return;
  if (e.key.toLowerCase() === 'f') { e.preventDefault(); toggleFullscreen(); }
});
// ===== Gestes tactiles (swipe) =====
const surface = document.querySelector('.viewer'); // ou '.stage' si tu veux limiter aux images
let touchStartX = 0, touchStartY = 0, touchStartT = 0;

const SWIPE_DIST = 50;   // distance minimale en px
const SWIPE_TIME = 700;  // durÃ©e max en ms
const ANGLE_TOL = 20;    // tolÃ©rance d'angle en degrÃ©s (pour bien sÃ©parer H/V)

// Helpers
function deg(absDy, absDx){ return Math.atan2(absDy, absDx) * 180 / Math.PI; }
function isUI(el){ return Boolean(el.closest('input,select,button')); }

// Changer d'exercice
function nextExercise(){
  stop();
  currentExercise = (currentExercise + 1) % MANIFEST.length;
  selectEl.value = currentExercise;
  loadExercise();
}
function prevExercise(){
  stop();
  currentExercise = (currentExercise - 1 + MANIFEST.length) % MANIFEST.length;
  selectEl.value = currentExercise;
  loadExercise();
}

surface.addEventListener('touchstart', (e) => {
  if (isUI(e.target)) return;          // ne pas capter sur les contrÃ´les
  if (e.touches.length !== 1) return;  // un seul doigt
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
  touchStartT = Date.now();
}, { passive: true });

surface.addEventListener('touchend', (e) => {
  if (!touchStartT) return;
  const t = Date.now() - touchStartT;
  touchStartT = 0;
  if (t > SWIPE_TIME) return;

  const touch = e.changedTouches && e.changedTouches[0];
  if (!touch) return;

  const dx = touch.clientX - touchStartX;
  const dy = touch.clientY - touchStartY;
  const adx = Math.abs(dx), ady = Math.abs(dy);
  if (adx < SWIPE_DIST && ady < SWIPE_DIST) return;

  // SÃ©paration horizontal vs vertical par l'angle
  const a = deg(ady, adx); // angle vs horizontal
  if (a <= ANGLE_TOL) {
    // swipe horizontal : exercice
    e.preventDefault();
    if (dx < 0) nextExercise();   // â† swipe gauche = exercice suivant
    else prevExercise();          // â†’ swipe droite = exercice prÃ©cÃ©dent
    return;
  }
  if (a >= 90 - ANGLE_TOL) {
    // swipe vertical : scÃ©nario
    e.preventDefault();
    stop();
    if (dy < 0) next();  // â†‘ suivant
    else prev();         // â†“ prÃ©cÃ©dent
  }
}, { passive: false });

// (Optionnel) : retour visuel lÃ©ger dans la barre de statut
document.addEventListener('fullscreenchange', () => {
  const state = document.fullscreenElement != null;
  statusEl.textContent = state ? 'Plein Ã©cran activÃ©' : 'Plein Ã©cran dÃ©sactivÃ©';
  setTimeout(() => { statusEl.textContent = `Ã‰tape ${idx+1} / ${layers.length}`; }, 900);
});

  </script>
</body>
</html>
